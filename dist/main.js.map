{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../node_modules/@alexeimyshkouski/node-tree/index.js","webpack:///./src/cache/index.js","webpack:///./src/collection.js","webpack:///./src/fetch.js","webpack:///./src/index.js","webpack:///./src/promiseTree.js","webpack:///./src/resource.js","webpack:///./src/transform/fields.js","webpack:///./src/transform/post/index.js","webpack:///./src/transform/post/sort.js","webpack:///./src/transform/pre/alias.js","webpack:///./src/transform/pre/index.js","webpack:///./src/transform/resourceProps.js","webpack:///./src/typeStore.js","webpack:///external \"avl\"","webpack:///external \"babel-runtime/core-js/array/from\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/object/define-properties\"","webpack:///external \"babel-runtime/core-js/object/entries\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/core-js/set\"","webpack:///external \"lodash/defaults\"","webpack:///external \"lodash/get\"","webpack:///external \"lodash/isEmpty\"","webpack:///external \"lodash/isNil\"","webpack:///external \"lodash/isObject\"","webpack:///external \"lodash/merge\"","webpack:///external \"lodash/omit\"","webpack:///external \"lodash/once\"","webpack:///external \"lodash/pick\"","webpack:///external \"lodash/set\""],"names":["IndexedCache","constructor","_avl","Avl","args","compare","keys","values","has","key","contains","a","b","set","value","insert","get","find","remove","ResourceCollection","from","ResourceConstructor","source","options","collection","forEach","resource","add","id","map","TypeError","type","toJSON","toJSONed","createQueryIds","data","_s","ResourceIdentifier","_i","ids","_ids","Array","isArray","fetch","queries","action","typeStore","TypeStore","ResourceObject","_fetch","typeOptions","query","prefetched","result","tree","PromiseTree","includedTree","opts","next","include","path","parse","index","slice","filter","r","resolve","console","dir","depth","Infinity","Resource","JsonApi","_connected","connect","_createTypeError","Function","Object","_resolveChildren","node","rootNode","child","all","children","_resolve","rejected","then","call","resolved","push","catch","error","Node","_r","_a","fields","relationships","RESOURCE_PROPS","reduce","entry","store","relationship","attributes","included","posttransform","sort","_sortByNumberOrCharCodes","vector","_sortByKey","rule","_parseSortRules","string","split","applySort","res","assignAlias","alias","fullPath","length","obj","_omitProps","_alias","aliased","pretransform","isOptionsPassed","defaults","merge","RESOURCE_IDENTIFIER_ESSENTIAL_PROPS","links","RESOURCE_OPTIONAL_PROPS","RESOURCE_IDENTIFIER_PROPS","RESOURCE_OBJECT_OPTIONAL_PROPS","single","defineProperty"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;ACnEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,qBAAqB,qBAAqB;AAC1C;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;;AAEP;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,0BAA0B;AAC1B;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;AC9IA;;;;;;AAEO,MAAMA,YAAN,CAAmB;AACxBC,gBAAc;AACZ,SAAKC,IAAL,GAAY,IAAIC,aAAJ,CAAQ,CAAC,GAAGC,IAAJ,KAAa,KAAKC,OAAL,CAAa,GAAGD,IAAhB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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","const Avl = require('avl')\n// import isString from 'lodash/isString'\n\nfunction isString(value) {\n  return (typeof value)[0] === 's'\n}\n\nfunction createParseError() {\n  return new TypeError(`Argument \"path\" should be non-empty string or array of strings`)\n}\n\nfunction _sub(path, Node) {\n  path = this.parse(path)\n  let node = this\n\n  for (let index = 0; index < path.length; index++) {\n    let key = path[index]\n    let child = node._children.find(key)\n\n    if (child) {\n      node = child.data\n    } else if (Node) {\n      child = new Node({\n        parse,\n        compare\n      } = node)\n\n      node._children.insert(key, child)\n\n      node = child\n    } else {\n      node = null\n      break\n    }\n  }\n\n  return node\n}\n\nconst methods = {\n  parse(path) {\n    if (Array.isArray(path)) {\n      for (let index in path) {\n        if (!isString(path[index])) {\n          throw createParseError()\n        }\n      }\n\n      return path\n    } else if (isString(path)) {\n      return path.split('.')\n    } else {\n      throw createParseError()\n    }\n  },\n\n  compare(a, b) {\n    a = methods.parse(a)\n    b = methods.parse(b)\n\n    if (a.length > b.length) {\n      return 1\n    } else if (a.length < b.length) {\n      return -1\n    } else {\n      for (let index in a) {\n        if (a[index] > b[index]) {\n          return 1\n        } else if (a[index] < b[index]) {\n          return -1\n        }\n      }\n    }\n\n    return 0\n  }\n}\n\nclass Node {\n  constructor(options = {}) {\n    for (let key in methods) {\n      this[key] = options[key] || methods[key]\n    }\n\n    Object.defineProperties(this, {\n      '_value': {\n        writable: true\n      },\n      '_children': {\n        value: new Avl(this.compare, true)\n      }\n    })\n  }\n\n  set() {\n    let path = []\n    let value = arguments[0]\n    if (1 in arguments) {\n      path = arguments[0]\n      value = arguments[1]\n    }\n\n    const node = _sub.call(this, path, Object.getPrototypeOf(this).constructor)\n\n    node._value = value\n\n    return node\n  }\n\n  sub(path) {\n    return _sub.call(this, path)\n  }\n\n  children() {\n    return this._children.values()\n  }\n\n  keys() {\n    return this._children.keys()\n  }\n\n  value() {\n    let node = this\n    if (0 in arguments) {\n      const sub = this.sub(arguments[0])\n\n      if (sub) {\n        node = sub\n      }\n    }\n\n    return node._value\n  }\n\n  forEach(f) {\n    this._children.forEach(node => {\n      f(node)\n    })\n    return this\n  }\n}\n\nmodule.exports = Node\n","import Avl from 'avl'\n\nexport class IndexedCache {\n  constructor() {\n    this._avl = new Avl((...args) => this.compare(...args), true)\n  }\n\n  keys() {\n    return this._avl.keys()\n  }\n\n  values() {\n    return this._avl.values()\n  }\n\n  has(key) {\n    return this._avl.contains(key)\n  }\n\n  compare(a, b) {\n    if (a < b) {\n      return -1\n    }\n\n    if (a > b) {\n      return 1\n    }\n\n    return 0\n  }\n\n  set(key, value) {\n    this._avl.insert(key, value)\n\n    return this\n  }\n\n  get(key) {\n    return this._avl.find(key)\n  }\n\n  remove(key) {\n    this._avl.remove(key)\n  }\n}\n","import {\n  IndexedCache\n} from './cache'\n\nimport get from 'lodash/get'\nimport posttransform from './transform/post'\n\nclass ResourceCollection extends IndexedCache {\n  static from(ResourceConstructor, source, options) {\n    const collection = new ResourceCollection()\n\n    source.forEach(source => {\n      const resource = new ResourceConstructor(source, options)\n      if (!collection.has(resource)) {\n        collection.add(resource)\n      }\n    })\n\n    return collection\n  }\n\n  compare(a, b) {\n    for (let key of ['type', 'id']) {\n      if (a[key] < b[key]) {\n        return -1\n      }\n\n      if (a[key] > b[key]) {\n        return 1\n      }\n    }\n\n    return 0\n  }\n\n  get id() {\n    return this.keys().map(key => key.id)\n  }\n\n  add(resource) {\n    if (typeof resource !== 'object') {\n      throw new TypeError()\n    }\n\n    const { type, id } = resource\n\n    return this.set({ type, id }, resource)\n  }\n\n  toJSON(options) {\n    const toJSONed = this.values().map(resource => resource.toJSON(options))\n    return posttransform(toJSONed)\n  }\n}\n\n// ;\n// ['map', 'filter'].forEach(prop => {\n//   ResourceCollection.prototype[prop] = function(iteratee) {\n//     this._c = this.entries()[prop](function _iteratee(entry, index, entries) {\n//       return iteratee.call(this, entry[1], index, entries)\n//     }).reduce((_c, [key, value]) => {\n//       _c[key] = value\n//       return _c\n//     }, {})\n//\n//     return this\n//   }\n// })\n\nexport default ResourceCollection\n","import merge from 'lodash/merge'\nimport isEmpty from 'lodash/isEmpty'\nimport isNil from 'lodash/isNil'\n\nimport {\n  ResourceObject,\n  ResourceIdentifier\n} from './resource'\nimport ResourceCollection from './collection'\n\nimport PromiseTree from './promiseTree'\nimport TypeStore from './typeStore'\n\nfunction createQueryIds(type, data) {\n  if (data._s instanceof ResourceIdentifier) {\n    const resource = data._s\n\n    if (resource._i && resource._i[type]) {\n      return resource._i[type]._s.id\n    }\n  } else if (data._s instanceof ResourceCollection) {\n    let ids = new Set()\n\n    const values = data._s.values()\n\n    values.forEach(resource => {\n      if (resource._i && resource._i[type]) {\n        const _ids = resource._i[type]._s.id\n\n        if (_ids) {\n          if (Array.isArray(_ids)) {\n            _ids.forEach(id => ids.add(id))\n          } else {\n            ids.add(_ids)\n          }\n        }\n      }\n    })\n\n    ids = Array.from(ids.values())\n\n    if (isEmpty(ids)) {\n      return null\n    }\n\n    return ids\n  }\n}\n\nexport default async function fetch(queries, action, type, options, ...args) {\n  const typeStore = new TypeStore(ResourceObject, [], {})\n\n  async function _fetch(type, typeOptions) {\n    const query = queries[type][action]\n    const prefetched = await query(typeOptions)\n\n    const result = {\n      data: new TypeStore(ResourceObject, prefetched.data, typeOptions)\n    }\n\n    return result\n  }\n\n  const typeOptions = options[type]\n\n  const tree = new PromiseTree()\n\n  const includedTree = tree.set([type], async (opts, next) => {\n    const result = await _fetch(type, typeOptions)\n\n    if ('include' in typeOptions) {\n      if (!('included' in result)) {\n        await next(result.data)\n      }\n    }\n\n    return result\n  })\n\n  typeOptions.include.map(path => {\n    return includedTree.parse(path)\n  }).forEach(path => {\n    path.forEach((type, index, path) => {\n      return includedTree.set(path.slice(0, index + 1), async (data, next) => {\n        if (data) {\n          const ids = createQueryIds(type, data)\n\n          if (isNil(ids) || isEmpty(ids)) {\n            return null\n          }\n\n          let typeOptions = Object.assign({}, options[type])\n\n          typeOptions.filter = merge({}, typeOptions.filter, {\n            id: ids\n          })\n\n          const result = await _fetch(type, typeOptions)\n\n          if (!('included' in result)) {\n            await next(result.data)\n          }\n\n          return result\n        }\n      })\n    })\n  })\n\n  const r = await tree.resolve(null)\n\n  console.dir(r.map(([path, r]) => {\n    if (r) {\n      const {\n        data\n      } = r\n      return [path, data ? data.toJSON() : data]\n    } else {\n      return [path, r]\n    }\n  }), {\n    depth: Infinity\n  })\n\n  return r\n}\n","import get from 'lodash/get'\nimport set from 'lodash/set'\n\nimport fetch from './fetch'\n\nimport * as Resource from './resource'\n\nclass JsonApi {\n  constructor(options = {}) {\n    this.options = {}\n    this._connected = {}\n  }\n\n  connect(type, fetch) {\n    const keys = [\n      'create',\n      'read',\n      'update',\n      'delete'\n    ]\n    const _createTypeError = () => new TypeError('Invalid argument type for fetch')\n    const _fetch = {}\n    if (fetch instanceof Function) {\n      keys.forEach(key => _fetch[key] = fetch)\n    } else if (fetch instanceof Object) {\n      keys.forEach(key => {\n        if (!_fetch[key] instanceof Function) {\n          throw _createTypeError()\n        }\n        _fetch[key] = fetch[key]\n      })\n    } else {\n      throw _createTypeError()\n    }\n\n    this._connected[type] = _fetch\n  }\n\n  fetch(action, type, options, ...args) {\n    return fetch(this._connected, action, type, options, ...args)\n  }\n}\n\nexport default JsonApi\n","import Node from '@alexeimyshkouski/node-tree'\nimport once from 'lodash/once'\n\nfunction _resolveChildren(data, node, rootNode) {\n  node.forEach(child => {\n    child.data.path = [...node.path, child.key]\n  })\n  return Promise.all(node.children().map(node => _resolve(data, node, rootNode)))\n}\n\nfunction _resolve(data, node, rootNode = node) {\n  if (rootNode.rejected) {\n    throw rootNode.rejected\n  }\n\n  if (node === rootNode) {\n    return _resolveChildren(data, node, rootNode).then(() => rootNode.value())\n  }\n\n  return Promise.resolve(data)\n    .then(data => {\n      const next = once(data => _resolveChildren(data, node, rootNode))\n      return node.value().call(null, data, next)\n    })\n    .then(data => {\n      node.resolved = data\n      rootNode.value().push([node.path, data])\n      return data\n    })\n    .catch(error => {\n      node.rejected = rootNode.rejected = error\n      throw error\n    })\n}\n\nclass PromiseTree extends Node {\n  constructor(options = {}) {\n    super(options)\n\n    this.set([])\n    this.path = []\n  }\n\n  resolve(data) {\n    return _resolve(data, this)\n  }\n}\n\nexport default PromiseTree\n","import set from 'lodash/set'\nimport get from 'lodash/get'\nimport pick from 'lodash/pick'\nimport isEmpty from 'lodash/isEmpty'\n\nimport {\n  RESOURCE_PROPS\n} from './transform/resourceProps'\nimport pretransform from './transform/pre'\nimport fields from './transform/fields'\nimport TypeStore from './typeStore'\n\nclass ResourceIdentifier {\n  constructor(source, options) {\n    Object.defineProperties(this, {\n      source: {\n        value: source\n      },\n      _r: {\n        value: pretransform(source, options)\n      }\n    })\n  }\n\n  get id() {\n    return this._r && this._r.id\n  }\n\n  get type() {\n    return this._r && this._r.type\n  }\n\n  toJSON(options) {\n    return pick(this._r, ['type', 'id', 'meta'])\n  }\n}\n\nclass ResourceObject extends ResourceIdentifier {\n  constructor(source, options) {\n    super(source, options)\n\n    this._a = fields(this._r, options.fields)\n    this._i = include(this.source, options.relationships)\n  }\n\n  set(...args) {\n    return set(this._r, ...args)\n  }\n\n  get(...args) {\n    return get(this._r, ...args)\n  }\n\n  toJSON(options) {\n    const resource = pick(this._r, RESOURCE_PROPS)\n\n    if (this._i) {\n      resource.relationships = Object.entries(this._i).reduce((relationships, entry) => {\n        const [type, store] = entry\n\n        const relationship = store.toJSON(options && options[type])\n\n        relationships[type] = {\n          data: isEmpty(relationship) ? null : relationship\n        }\n\n        return relationships\n      }, {})\n    }\n\n    if (this._a) {\n      resource.attributes = this._a\n    }\n\n    return resource\n  }\n}\n\nfunction include(source, options) {\n  if (typeof options === 'object') {\n    const included = {}\n\n    for (let type in options) {\n      included[type] = new TypeStore(ResourceIdentifier, source, options[type])\n    }\n\n    return included\n  }\n\n  return null\n}\n\n// const source = {\n//   '_id': 1,\n//   'author': 1\n// }\n//\n// const options = {\n//   alias: {\n//     'id': '_id',\n//     'meta.source': ''\n//   },\n//   defaults: {\n//     'type': 'articles'\n//   },\n//   relationships: {\n//     'author': {\n//       from: 'author',\n//       alias: {\n//         'id': ''\n//       },\n//       defaults: {\n//         'type': 'people'\n//       }\n//     }\n//   }\n// }\n//\n// const i = new ResourceObject(source, options)\n// console.dir(i.toJSON(), {\n//   depth: Infinity\n// })\n\nexport {\n  ResourceObject,\n  ResourceIdentifier\n}\n","import pick from 'lodash/pick'\nimport isEmpty from 'lodash/isEmpty'\n\nexport default (data, options) => {\n  const attributes = pick(data.attributes, options)\n\n  if(!isEmpty(attributes)) {\n    data.attributes = attributes\n  }\n\n  return data\n}\n","import sort from './sort'\n\nconst posttransform = (data, options) => {\n  if(!options) {\n    return data\n  }\n\n  if('sort' in options) {\n    data = sort(data, options.sort)\n  }\n\n  // if('page' in options) {\n  //   data = paginate(data, options.page)\n  // }\n\n  return data\n}\n\nexport default posttransform\n","import get from 'lodash/get'\n\nfunction _sortByNumberOrCharCodes(vector, a, b) {\n  if (a > b) {\n    return vector\n  } else if (a < b) {\n    return -1 * vector\n  }\n\n  return 0\n}\n\nfunction _sortByKey(rule, a, b) {\n  const [key, vector] = rule\n  return _sortByNumberOrCharCodes(vector, get(a, key), get(b, key))\n}\n\nfunction _parseSortRules(options) {\n\n  return string.split(',')\n}\n\nconst applySort = (data, options) => {\n  if(typeof options === 'string') {\n    options = options.split(',')\n  }\n\n  if(!Array.isArray(options)) {\n    throw new TypeError('Sort options should be an array or string')\n  }\n\n  options = options.map(rule => {\n    if(typeof rule === 'string') {\n      rule = (rule[0] == '-') ? [rule.slice(1), -1] : [rule, 1]\n    }\n\n    if(!Array.isArray(rule)) {\n      throw new TypeError('Sort rules should be an array or string')\n    }\n\n    if(typeof rule[1] !== 'number') {\n      throw new TypeError('Sort order should be a number')\n    }\n\n    return rule\n  })\n\n  return data.sort((a, b) => {\n    if('attributes' in a && 'attributes' in b) {\n      for (let rule of options) {\n        const res = _sortByKey(rule, a.attributes, b.attributes)\n\n        if (res) {\n          return res\n        }\n      }\n    }\n\n    return 0\n  })\n}\n\nexport default applySort\n","import omit from 'lodash/omit'\nimport set from 'lodash/set'\nimport get from 'lodash/get'\n\nfunction assignAlias(data, alias, fullPath) {\n  if (typeof alias == 'string') {\n    return alias.length ? get(data, alias) : data\n  } else {\n    let obj = Array.isArray(alias) ? [] : Object.assign({}, data)\n\n    if (typeof alias == 'object') {\n      const _omitProps = []\n\n      for (let key in alias) {\n        const path = fullPath + key\n\n        let _alias = alias[key]\n\n        const aliased = assignAlias(data, _alias, path)\n\n        if (path != _alias) {\n          _omitProps.push(_alias)\n        }\n\n        set(obj, key, aliased)\n      }\n\n      if (_omitProps.length) {\n        obj = omit(obj, _omitProps)\n      }\n    }\n\n    return obj\n  }\n}\n\nexport default function(data, options) {\n  return assignAlias(data, options, '')\n}\n","import merge from 'lodash/merge'\nimport defaults from 'lodash/defaults'\nimport pick from 'lodash/pick'\nimport isObject from 'lodash/isObject'\nimport isNil from 'lodash/isNil'\n\nimport assignAlias from './alias'\nimport {\n  RESOURCE_IDENTIFIER_ESSENTIAL_PROPS\n} from '../resourceProps'\n\nfunction pretransform(data, options) {\n  if (isNil(data)) {\n    return data\n  }\n\n  const isOptionsPassed = isObject(options)\n\n  if (isOptionsPassed) {\n    if ('alias' in options) {\n      data = assignAlias(data, options.alias)\n    }\n\n    if ('defaults' in options) {\n      data = defaults({}, data, options.defaults)\n    }\n\n    if ('merge' in options) {\n      data = merge({}, data, options.merge)\n    }\n  }\n\n  if (isObject(data)) {\n    data = RESOURCE_IDENTIFIER_ESSENTIAL_PROPS.reduce((data, key) => {\n      if (isNil(data[key])) {\n        const error = new TypeError(`Cannot transform '${ key }' prop to string`)\n        error.data = data\n        error.key = key\n        throw error\n      }\n\n      data[key] += ''\n\n      return data\n    }, Object.assign({}, data))\n  }\n\n  if (isOptionsPassed) {\n    if ('links' in options) {\n      data.links = options.links(data.type, data.id)\n    }\n  }\n\n  return data\n}\n\nexport default pretransform\n","// resource identifier & object members\nexport const RESOURCE_OPTIONAL_PROPS = ['meta']\n\n// resource identifier members\nexport const RESOURCE_IDENTIFIER_ESSENTIAL_PROPS = ['type', 'id']\nexport const RESOURCE_IDENTIFIER_PROPS = [...RESOURCE_IDENTIFIER_ESSENTIAL_PROPS, ...RESOURCE_OPTIONAL_PROPS]\n\n// resource object members\nexport const RESOURCE_OBJECT_OPTIONAL_PROPS = ['attributes', 'relationships', 'links', ...RESOURCE_OPTIONAL_PROPS]\nexport const RESOURCE_PROPS = [\n  ...RESOURCE_IDENTIFIER_ESSENTIAL_PROPS,\n  ...RESOURCE_OBJECT_OPTIONAL_PROPS\n]\n","import ResourceCollection from './collection'\nimport get from 'lodash/get'\n\nclass TypeStore {\n  constructor(ResourceConstructor, source, options) {\n    if ('from' in options) {\n      source = get(source, options.from)\n    }\n\n    let single = false\n\n    if (Array.isArray(source)) {\n      this._s = ResourceCollection.from(ResourceConstructor, source, options)\n    } else {\n      single = true\n      this._s = new ResourceConstructor(source, options)\n    }\n\n    Object.defineProperty(this, 'single', {\n      value: single\n    })\n  }\n\n  toJSON(options) {\n    return this._s.toJSON(options)\n  }\n}\n\nexport default TypeStore\n","module.exports = require(\"avl\");","module.exports = require(\"babel-runtime/core-js/array/from\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"babel-runtime/core-js/object/define-properties\");","module.exports = require(\"babel-runtime/core-js/object/entries\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/core-js/set\");","module.exports = require(\"lodash/defaults\");","module.exports = require(\"lodash/get\");","module.exports = require(\"lodash/isEmpty\");","module.exports = require(\"lodash/isNil\");","module.exports = require(\"lodash/isObject\");","module.exports = require(\"lodash/merge\");","module.exports = require(\"lodash/omit\");","module.exports = require(\"lodash/once\");","module.exports = require(\"lodash/pick\");","module.exports = require(\"lodash/set\");"],"sourceRoot":""}