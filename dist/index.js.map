{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/collection/id.js","webpack:///./src/collection/index.js","webpack:///./src/collection/object.js","webpack:///./src/collection/transform/index.js","webpack:///./src/collection/transform/paginate.js","webpack:///./src/collection/transform/paginationStrategies.js","webpack:///./src/collection/transform/sort.js","webpack:///./src/fetch.js","webpack:///./src/helpers/compareResourceIDs.js","webpack:///./src/index.js","webpack:///./src/promiseTree.js","webpack:///./src/resource/id.js","webpack:///./src/resource/index.js","webpack:///./src/resource/object.js","webpack:///./src/resource/props.js","webpack:///./src/transform/id/alias.js","webpack:///./src/transform/id/post.js","webpack:///./src/transform/id/pre.js","webpack:///./src/transform/object/post.js","webpack:///./src/transform/object/pre.js","webpack:///./src/tree.js","webpack:///external \"avl\"","webpack:///external \"babel-runtime/core-js/array/from\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/core-js/set\"","webpack:///external \"lodash/defaults\"","webpack:///external \"lodash/get\"","webpack:///external \"lodash/isEmpty\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/isNil\"","webpack:///external \"lodash/isObject\"","webpack:///external \"lodash/isString\"","webpack:///external \"lodash/merge\"","webpack:///external \"lodash/omit\"","webpack:///external \"lodash/once\"","webpack:///external \"lodash/pick\"","webpack:///external \"lodash/set\""],"names":["ResourceIDCollection","constructor","source","options","_avl","Avl","compareResourceIDs","_isArray","_isEmpty","ResourceConstructor","arguments","length","Array","isArray","forEach","resource","ResourceID","has","add","count","isEmpty","toJSON","globalScopeCollection","values","map","resourceID","contains","get","node","find","data","keys","entries","push","key","insert","update","ResourceObjectCollection","_include","included","_included","type","ResourceCollection","merge","a","collections","reduce","collection","concat","ResourceObject","prototype","call","postTransform","sort","page","paginationStrategies","PAGINATION_LINKS_PROPS","applyPagination","dataArray","strategy","ReferenceError","offset","end","bounds","limit","prop","createQuery","query","slice","parsePaginationQueryParam","param","fallback","parseInt","isNaN","Math","floor","tranformPaginationQuery","clientLimit","serverLimit","Infinity","_offset","_limit","self","_end","next","prev","first","last","_sortByNumberOrCharCodes","vector","b","_sortByKey","rule","attr","_parseSortRules","string","split","TypeError","res","createQueryIds","id","ids","fetch","queries","action","args","_fetch","typeOptions","prefetched","result","tree","PromiseTree","includedTree","set","opts","include","path","parse","index","filter","r","resolve","compare","JsonApi","_connected","connect","_createTypeError","Function","Object","fetched","_resolveChildren","rootNode","children","child","all","_resolve","rejected","then","value","resolved","catch","error","Node","transform","_source","_value","from","relationships","attribute","attributes","test","someAttr","defaults","someOtherAttr","RESOURCE_OPTIONAL_PROPS","RESOURCE_IDENTIFIER_ESSENTIAL_PROPS","RESOURCE_IDENTIFIER_PROPS","RESOURCE_OBJECT_OPTIONAL_PROPS","RESOURCE_PROPS","assignAlias","alias","fullPath","obj","_omitProps","_alias","aliased","transformObject","fields","coreTransformObject","alienMembers","links","createParseError","bind","sub","create","append"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import Avl from 'avl'\r\nimport get from 'lodash/get'\r\n\r\nimport ResourceID from '../resource/id'\r\nimport compareResourceIDs from '../helpers/compareResourceIDs'\r\n\r\nclass ResourceIDCollection {\r\n  constructor(source, options) {\r\n    Object.assign(this, {\r\n      _avl: new Avl(compareResourceIDs, true),\r\n      _isArray: false,\r\n      _isEmpty: true\r\n    })\r\n\r\n    const ResourceConstructor = this.ResourceConstructor\r\n\r\n    if(arguments.length) {\r\n      if (Array.isArray(source)) {\r\n        source.forEach(source => {\r\n          const resource = source instanceof ResourceID ? source : new ResourceConstructor(source, options)\r\n\r\n          if (!this.has(resource)) {\r\n            this.add(resource)\r\n          }\r\n        })\r\n\r\n        if (this.count()) {\r\n          this._isEmpty = false\r\n        }\r\n        this._isArray = true\r\n      } else {\r\n        const resource = source instanceof ResourceID ? source : new ResourceConstructor(source, options)\r\n        this.add(resource)\r\n        this._isArray = false\r\n        this._isEmpty = false\r\n      }\r\n    }\r\n  }\r\n\r\n  get ResourceConstructor() {\r\n    return ResourceID\r\n  }\r\n\r\n  isArray() {\r\n    return this._isArray\r\n  }\r\n\r\n  isEmpty() {\r\n    return this._isEmpty\r\n  }\r\n\r\n  toJSON(options, globalScopeCollection = this) {\r\n    if(this.isArray()) {\r\n      return this.values().map(resourceID => resourceID.toJSON(options))\r\n    } else if(this.isEmpty()) {\r\n      return null\r\n    } else {\r\n      const resourceID = this.values()[0]\r\n      return resourceID.toJSON(options)\r\n    }\r\n  }\r\n\r\n  has(resourceID) {\r\n    return this._avl.contains(resourceID)\r\n  }\r\n\r\n  get(resourceID) {\r\n    const node = this._avl.find(resourceID)\r\n    if(node) {\r\n      return node.data\r\n    }\r\n  }\r\n\r\n  keys() {\r\n    return this._avl.keys()\r\n  }\r\n\r\n  values() {\r\n    return this._avl.values()\r\n  }\r\n\r\n  entries() {\r\n    const entries = []\r\n\r\n    this._avl.forEach(node => {\r\n      entries.push([\r\n        node.key,\r\n        node.data\r\n      ])\r\n    })\r\n\r\n    return entries\r\n  }\r\n\r\n  count() {\r\n    return this.keys().length\r\n  }\r\n\r\n  add(resource) {\r\n    this._avl.insert(resource, resource)\r\n\r\n    return this.count()\r\n  }\r\n\r\n  update(resource) {\r\n    if(this.has(resource)) {\r\n      this.add(resource)\r\n      return true\r\n    }\r\n\r\n    return false\r\n  }\r\n}\r\n\r\nexport default ResourceIDCollection\r\n","import ResourceIDCollection from './id'\r\nimport ResourceObjectCollection from './object'\r\n\r\nexport {\r\n  ResourceIDCollection,\r\n  ResourceObjectCollection\r\n}\r\n","import ResourceIDCollection from './id'\r\nimport ResourceObject from '../resource/object'\r\nimport transform from './transform'\r\n\r\nfunction _include(resource) {\r\n  const included = resource.included()\r\n\r\n  if (included) {\r\n    if (!this._included) {\r\n      this._included = {}\r\n    }\r\n\r\n    for (let type in included) {\r\n      if (!(type in this._included)) {\r\n        this._included[type] = new ResourceIDCollection()\r\n      }\r\n\r\n      included[type].values().forEach(resource => {\r\n        this._included[type].add(resource)\r\n      })\r\n    }\r\n  }\r\n\r\n  return included\r\n}\r\n\r\nclass ResourceCollection extends ResourceIDCollection {\r\n  static merge(a, ...collections) {\r\n    const source = [a, ...collections].reduce((source, collection) => source.concat(collection.values()), [])\r\n    return new ResourceCollection(source, {})\r\n  }\r\n\r\n  get ResourceConstructor() {\r\n    return ResourceObject\r\n  }\r\n\r\n  add(resource) {\r\n    const count = ResourceIDCollection.prototype.add.call(this, resource)\r\n\r\n    _include.call(this, resource)\r\n\r\n    return count\r\n  }\r\n\r\n  included() {\r\n    if(arguments.length) {\r\n      return this._included[arguments[0]]\r\n    }\r\n    return this._included\r\n  }\r\n\r\n  toJSON(options, globalScopeCollection = this) {\r\n    return transform(this.values(), options, globalScopeCollection).map(resource => resource.toJSON(options))\r\n  }\r\n}\r\n\r\nexport default ResourceCollection\r\n","import sort from './sort'\r\nimport paginate from './paginate'\r\n\r\nconst postTransform = (data, options, globalScopeCollection) => {\r\n  if (!options) {\r\n    return data\r\n  }\r\n\r\n  if ('sort' in options) {\r\n    data = sort(data, options.sort, globalScopeCollection)\r\n  }\r\n\r\n  if ('page' in options) {\r\n    data = paginate(data, options.page)\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nexport default postTransform\r\n","import isFunction from 'lodash/isFunction'\r\n\r\nimport * as paginationStrategies from './paginationStrategies'\r\n\r\nconst PAGINATION_LINKS_PROPS = ['self', 'first', 'last', 'prev', 'next']\r\n\r\nconst applyPagination = (dataArray, options) => {\r\n  let strategy = options\r\n\r\n  if ('strategy' in options) {\r\n    strategy = paginationStrategies[options.strategy]\r\n\r\n    if (!strategy) {\r\n      throw new ReferenceError('Cannot use pagination strategy:', options.strategy)\r\n    }\r\n  }\r\n\r\n  const {\r\n    offset,\r\n    end\r\n  } = strategy.bounds(dataArray.length, options.offset, options.limit)\r\n\r\n  for(let prop of PAGINATION_LINKS_PROPS) {\r\n    const createQuery = strategy[prop]\r\n    if(createQuery) {\r\n      let query\r\n      if(isFunction(createQuery)) {\r\n        query = createQuery(dataArray.length, offset, end, options.limit)\r\n      } else {\r\n        query = createQuery\r\n      }\r\n      // console.log('!', query)\r\n      /**\r\n        * TODO add links to collection body\r\n      */\r\n    }\r\n  }\r\n\r\n  dataArray = dataArray.slice(offset, end)\r\n\r\n  // if (!dataArray.length) {\r\n  //   dataArray = null\r\n  // }\r\n\r\n  return dataArray\r\n}\r\n\r\nexport default applyPagination\r\n","function parsePaginationQueryParam(param, fallback = 0) {\r\n  param = parseInt(param)\r\n\r\n  if (isNaN(param)) {\r\n    param = fallback\r\n  } else {\r\n    param = Math.floor(param)\r\n  }\r\n\r\n  return param\r\n}\r\n\r\nfunction tranformPaginationQuery(length, offset, limit) {\r\n  offset = parsePaginationQueryParam(offset, 0)\r\n  limit = parsePaginationQueryParam(limit, length)\r\n\r\n  if (offset < 0) {\r\n    offset += length\r\n  }\r\n\r\n  if (offset < 0) {\r\n    offset = 0\r\n  } else if (offset >= length) {\r\n    offset = length\r\n  }\r\n\r\n  if (limit < 0) {\r\n    limit = 0\r\n  } else if (offset + limit > length) {\r\n    limit = length - offset\r\n  }\r\n\r\n  return {\r\n    offset,\r\n    limit\r\n  }\r\n}\r\n\r\nexport const offset = {\r\n  limit(clientLimit, serverLimit) {\r\n    let limit = parsePaginationQueryParam(clientLimit)\r\n\r\n    if (limit >= 1 && limit < serverLimit) {\r\n      limit = Math.floor(limit)\r\n    } else if (serverLimit) {\r\n      limit = serverLimit\r\n    } else {\r\n      limit = Infinity\r\n    }\r\n\r\n    return limit\r\n  },\r\n\r\n  bounds(length, _offset, _limit) {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(length, _offset, _limit)\r\n\r\n    return {\r\n      offset,\r\n      end: offset + limit\r\n    }\r\n  },\r\n  self(length, _offset, _end, _limit) {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(length, _offset, _limit)\r\n\r\n    return {\r\n      offset,\r\n      limit\r\n    }\r\n  },\r\n  next(length, _offset, _end, _limit) {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(length, _end, _limit)\r\n\r\n    if (!limit) {\r\n      return null\r\n    }\r\n\r\n    return {\r\n      offset,\r\n      limit\r\n    }\r\n  },\r\n  prev: (length, _offset, _end, _limit) => {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(_offset, _offset - _limit, _limit)\r\n\r\n    if (!limit) {\r\n      return null\r\n    }\r\n\r\n    return {\r\n      offset,\r\n      limit\r\n    }\r\n  },\r\n  first: (length, _offset, _end, _limit) => {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(length, 0, _limit > length ? length : (_limit > _offset && _offset > 0 ? _offset : _limit))\r\n\r\n    return {\r\n      offset,\r\n      limit: _limit\r\n    }\r\n  },\r\n  last: (length, _offset, _end, _limit) => {\r\n    const {\r\n      offset,\r\n      limit\r\n    } = tranformPaginationQuery(length, 2 * _limit < length ? length - _limit : (_limit < length ? (_end + _limit < length ? _end : length - _limit) : 0), _limit)\r\n\r\n    return {\r\n      offset,\r\n      limit\r\n    }\r\n  }\r\n}\r\n","import get from 'lodash/get'\r\n\r\nfunction _sortByNumberOrCharCodes(vector, a, b) {\r\n  if (a > b) {\r\n    return vector\r\n  } else if (a < b) {\r\n    return -1 * vector\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nfunction _sortByKey(rule, a, b) {\r\n  const [prop, vector] = rule\r\n  return _sortByNumberOrCharCodes(vector, a.attr(prop), b.attr(prop))\r\n}\r\n\r\nfunction _parseSortRules(options) {\r\n  return string.split(',')\r\n}\r\n\r\nfunction sort(data, options, globalScopeCollection) {\r\n  if (typeof options === 'string') {\r\n    options = options.split(',')\r\n  }\r\n\r\n  if (!Array.isArray(options)) {\r\n    throw new TypeError('Sort options should be an array or string')\r\n  }\r\n\r\n  options = options.map(rule => {\r\n    if (typeof rule === 'string') {\r\n      rule = (rule[0] == '-') ? [rule.slice(1), -1] : [rule, 1]\r\n    }\r\n\r\n    if (!Array.isArray(rule)) {\r\n      throw new TypeError('Sort rules should be an array or string')\r\n    }\r\n\r\n    if (typeof rule[1] !== 'number') {\r\n      throw new TypeError('Sort order should be a number')\r\n    }\r\n\r\n    return rule\r\n  })\r\n\r\n  return data.sort((a, b) => {\r\n    for (let rule of options) {\r\n      const res = _sortByKey(rule, globalScopeCollection.get(a), globalScopeCollection.get(b))\r\n\r\n      if (res) {\r\n        return res\r\n      }\r\n    }\r\n\r\n    return 0\r\n  })\r\n}\r\n\r\nexport default sort\r\n","import merge from 'lodash/merge'\r\nimport isEmpty from 'lodash/isEmpty'\r\nimport isNil from 'lodash/isNil'\r\n\r\nimport {\r\n  ResourceObject,\r\n  ResourceID\r\n} from './resource'\r\nimport {\r\n  ResourceIDCollection,\r\n  ResourceObjectCollection\r\n} from './collection'\r\n\r\nimport PromiseTree from './promiseTree'\r\n\r\nfunction createQueryIds(type, data) {\r\n  if (data instanceof ResourceID) {\r\n    let included = data.included(type)\r\n\r\n    if (included) {\r\n      return included.id\r\n    }\r\n  } else if (data instanceof ResourceObjectCollection) {\r\n    let ids = new Set()\r\n\r\n    const values = data.values()\r\n\r\n    values.forEach(resource => {\r\n      let included = resource.included(type)\r\n      if (included) {\r\n        // console.log(resource.type, resource.id, 'includes', included.count(), type, included.values())\r\n        if (included.isArray()) {\r\n          included.values().forEach(resource => {\r\n            ids.add(resource.id)\r\n          })\r\n        } else {\r\n          ids.add(included.values()[0].id)\r\n        }\r\n      }\r\n    })\r\n\r\n    ids = Array.from(ids.values())\r\n\r\n    if (isEmpty(ids)) {\r\n      return null\r\n    }\r\n\r\n    return ids\r\n  }\r\n}\r\n\r\nexport default async function fetch(queries, action, type, options, ...args) {\r\n  const globalScopeCollection = new ResourceObjectCollection()\r\n\r\n  async function _fetch(type, typeOptions) {\r\n    const query = queries[type][action]\r\n    const prefetched = await query(typeOptions)\r\n\r\n    const result = {\r\n      data: new ResourceObjectCollection(prefetched.data, typeOptions)\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  const typeOptions = options[type]\r\n\r\n  const tree = new PromiseTree()\r\n\r\n  const includedTree = tree.set([type], async (opts, next) => {\r\n    const result = await _fetch(type, typeOptions)\r\n\r\n    if ('include' in typeOptions) {\r\n      if (!('included' in result)) {\r\n        await next(result.data)\r\n      }\r\n    }\r\n\r\n    return result\r\n  })\r\n\r\n  typeOptions.include.map(path => {\r\n    return includedTree.parse(path)\r\n  }).forEach(path => {\r\n    path.forEach((type, index, path) => {\r\n      includedTree.set(path.slice(0, index + 1), async (data, next) => {\r\n        if (data) {\r\n          const ids = createQueryIds(type, data)\r\n\r\n          if (isNil(ids) || isEmpty(ids)) {\r\n            return null\r\n          }\r\n\r\n          let typeOptions = Object.assign({}, options[type])\r\n\r\n          typeOptions.filter = merge({}, typeOptions.filter, {\r\n            id: ids\r\n          })\r\n\r\n          const result = await _fetch(type, typeOptions)\r\n\r\n          if (!('included' in result)) {\r\n            await next(result.data)\r\n          }\r\n\r\n          return result\r\n        }\r\n      })\r\n    })\r\n  })\r\n\r\n  const r = await tree.resolve(null)\r\n\r\n  return r\r\n}\r\n","export default function compare(a, b) {\r\n  if (!a) {\r\n    if (!b) {\r\n      return 0\r\n    }\r\n\r\n    return -1\r\n  } else if (!b) {\r\n    return 1\r\n  }\r\n\r\n  for (let key of ['type', 'id']) {\r\n    if (a[key] < b[key]) {\r\n      return -1\r\n    }\r\n\r\n    if (a[key] > b[key]) {\r\n      return 1\r\n    }\r\n  }\r\n\r\n  return 0\r\n}\r\n","import get from 'lodash/get'\r\nimport set from 'lodash/set'\r\n\r\nimport fetch from './fetch'\r\n\r\nimport {\r\n  ResourceObject,\r\n  ResourceID\r\n} from './resource'\r\n\r\nimport {\r\n  ResourceIDCollection,\r\n  ResourceObjectCollection\r\n} from './collection'\r\n\r\nclass JsonApi {\r\n  static get ResourceObject() {\r\n    return ResourceObject\r\n  }\r\n\r\n  static get ResourceID() {\r\n    return ResourceID\r\n  }\r\n\r\n  static get ResourceObjectCollection() {\r\n    return ResourceObjectCollection\r\n  }\r\n\r\n  static get ResourceIDCollection() {\r\n    return ResourceIDCollection\r\n  }\r\n\r\n  constructor(options = {}) {\r\n    this.options = {}\r\n    this._connected = {}\r\n  }\r\n\r\n  connect(type, fetch) {\r\n    const keys = [\r\n      'create',\r\n      'read',\r\n      'update',\r\n      'delete'\r\n    ]\r\n    const _createTypeError = () => new TypeError('Invalid argument type for fetch')\r\n    const _fetch = {}\r\n    if (fetch instanceof Function) {\r\n      keys.forEach(key => _fetch[key] = fetch)\r\n    } else if (fetch instanceof Object) {\r\n      keys.forEach(key => {\r\n        if (!_fetch[key] instanceof Function) {\r\n          throw _createTypeError()\r\n        }\r\n        _fetch[key] = fetch[key]\r\n      })\r\n    } else {\r\n      throw _createTypeError()\r\n    }\r\n\r\n    this._connected[type] = _fetch\r\n  }\r\n\r\n  async fetch(action, type, options, ...args) {\r\n    const fetched = await fetch(this._connected, action, type, options, ...args)\r\n    return fetched\r\n  }\r\n}\r\n\r\nexport default JsonApi\r\n","import Node from './tree'\r\nimport once from 'lodash/once'\r\n\r\nfunction _resolveChildren(data, node, rootNode) {\r\n  node.children.forEach(child => {\r\n    child.data.path = [...node.path, child.key]\r\n  })\r\n  return Promise.all(node.children.values().map(node => _resolve(data, node, rootNode)))\r\n}\r\n\r\nfunction _resolve(data, node, rootNode = node) {\r\n  if (rootNode.rejected) {\r\n    throw rootNode.rejected\r\n  }\r\n\r\n  if (node === rootNode) {\r\n    return _resolveChildren(data, node, rootNode).then(() => rootNode.value)\r\n  }\r\n\r\n  return Promise.resolve(data)\r\n    .then(data => {\r\n      const next = once(data => _resolveChildren(data, node, rootNode))\r\n      return node.value.call(null, data, next)\r\n    })\r\n    .then(data => {\r\n      node.resolved = data\r\n      rootNode.value.push([node.path, data])\r\n      return data\r\n    })\r\n    .catch(error => {\r\n      node.rejected = rootNode.rejected = error\r\n      throw error\r\n    })\r\n}\r\n\r\nclass PromiseTree extends Node {\r\n  constructor(options = {}) {\r\n    super(options)\r\n\r\n    this.set([])\r\n    this.path = []\r\n  }\r\n\r\n  resolve(data) {\r\n    return _resolve(data, this)\r\n  }\r\n}\r\n\r\nexport default PromiseTree\r\n","import pick from 'lodash/pick'\r\nimport {\r\n  RESOURCE_IDENTIFIER_PROPS\r\n} from './props'\r\n\r\nimport preTransformID from '../transform/id/pre'\r\nimport postTransformID from '../transform/id/post'\r\n\r\nexport default class ResourceID {\r\n  static transform(source, options) {\r\n    return preTransformID(source, options)\r\n  }\r\n\r\n  constructor(source, options) {\r\n    this._source = source\r\n    // console.log('source', this._source)\r\n    // console.log('options', options)\r\n    this._value = preTransformID(source, options)\r\n    // console.log('value', this._value)\r\n  }\r\n\r\n  get id() {\r\n    return this._value && this._value.id\r\n  }\r\n\r\n  get type() {\r\n    return this._value && this._value.type\r\n  }\r\n\r\n  toJSON(options) {\r\n    return postTransformID(this._value)\r\n  }\r\n}\r\n","import ResourceID from './id'\r\nimport ResourceObject from './object'\r\n\r\nexport {\r\n  ResourceID,\r\n  ResourceObject\r\n}\r\n","import get from 'lodash/get'\r\n\r\nimport ResourceID from './id'\r\nimport ResourceIDCollection from '../collection/id'\r\n\r\nimport preTransformID from '../transform/id/pre'\r\n\r\nimport preTransformObject from '../transform/object/pre'\r\nimport postTransformObject from '../transform/object/post'\r\n\r\nfunction include(source, options) {\r\n  if (typeof options === 'object') {\r\n    const included = {}\r\n\r\n    for (let type in options) {\r\n      const typeOptions = options[type]\r\n      let _source = source\r\n\r\n      if('from' in typeOptions) {\r\n        _source = get(source, typeOptions.from)\r\n      }\r\n\r\n      included[type] = new ResourceIDCollection(_source, typeOptions)\r\n    }\r\n\r\n    return included\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nclass ResourceObject extends ResourceID {\r\n  static transform(source, options) {\r\n    return preTransformObject(preTransformID(source, options))\r\n  }\r\n\r\n  constructor(source, options = {}) {\r\n    super(source, options)\r\n\r\n    this._value = preTransformObject(this._value, options)\r\n\r\n    this._included = include(source, options.relationships)\r\n  }\r\n\r\n  get attr() {\r\n    return this.attribute\r\n  }\r\n\r\n  attribute(path) {\r\n    return get(this.attributes(), path)\r\n  }\r\n\r\n  attributes() {\r\n    if(this._value) {\r\n      return this._value.attributes\r\n    }\r\n  }\r\n\r\n  included() {\r\n    if(arguments.length) {\r\n      return this._included[arguments[0]]\r\n    }\r\n    return this._included\r\n  }\r\n\r\n  toJSON(options) {\r\n    return postTransformObject(this._value, options)\r\n  }\r\n}\r\n\r\nconst source = {\r\n  id: 0,\r\n  test: true,\r\n  someAttr: 'someValue'\r\n}\r\n\r\nconst options = {\r\n  // fields: [\r\n  //   'test'\r\n  // ],\r\n  defaults: {\r\n    type: '#test'\r\n  },\r\n  merge: {\r\n    attributes: {\r\n      someOtherAttr: 'someOtherValue'\r\n    }\r\n  }\r\n}\r\n\r\n// const rID = new ResourceID(source, options)\r\n// const r = new ResourceObject(source, options)\r\n//\r\n// console.log(rID.toJSON())\r\n// console.log(r.toJSON())\r\n\r\nexport default ResourceObject\r\n","// resource identifier & object members\r\nexport const RESOURCE_OPTIONAL_PROPS = ['meta']\r\n\r\n// resource identifier members\r\nexport const RESOURCE_IDENTIFIER_ESSENTIAL_PROPS = ['type', 'id']\r\nexport const RESOURCE_IDENTIFIER_PROPS = [...RESOURCE_IDENTIFIER_ESSENTIAL_PROPS, ...RESOURCE_OPTIONAL_PROPS]\r\n\r\n// resource object members\r\nexport const RESOURCE_OBJECT_OPTIONAL_PROPS = ['attributes', 'relationships', 'links', ...RESOURCE_OPTIONAL_PROPS]\r\nexport const RESOURCE_PROPS = [\r\n  ...RESOURCE_IDENTIFIER_ESSENTIAL_PROPS,\r\n  ...RESOURCE_OBJECT_OPTIONAL_PROPS\r\n]\r\n","import omit from 'lodash/omit'\r\nimport set from 'lodash/set'\r\nimport get from 'lodash/get'\r\n\r\nfunction assignAlias(data, alias, fullPath) {\r\n  if (typeof alias == 'string') {\r\n    return alias.length ? get(data, alias) : data\r\n  } else {\r\n    let obj = Array.isArray(alias) ? [] : Object.assign({}, data)\r\n\r\n    if (typeof alias == 'object') {\r\n      const _omitProps = []\r\n\r\n      for (let key in alias) {\r\n        const path = fullPath + key\r\n\r\n        let _alias = alias[key]\r\n\r\n        const aliased = assignAlias(data, _alias, path)\r\n\r\n        if (path != _alias) {\r\n          _omitProps.push(_alias)\r\n        }\r\n\r\n        set(obj, key, aliased)\r\n      }\r\n\r\n      if (_omitProps.length) {\r\n        obj = omit(obj, _omitProps)\r\n      }\r\n    }\r\n\r\n    return obj\r\n  }\r\n}\r\n\r\nexport default function(data, options) {\r\n  return assignAlias(data, options, '')\r\n}\r\n","import pick from 'lodash/pick'\r\nimport isObject from 'lodash/isObject'\r\nimport isNil from 'lodash/isNil'\r\n\r\nimport {\r\n  RESOURCE_IDENTIFIER_PROPS\r\n} from '../../resource/props'\r\n\r\nfunction transform(data, options) {\r\n  if (isNil(data)) {\r\n    return null\r\n  }\r\n\r\n  if (isObject(data)) {\r\n    data = pick(data, RESOURCE_IDENTIFIER_PROPS)\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nexport default transform\r\n","import merge from 'lodash/merge'\r\nimport defaults from 'lodash/defaults'\r\nimport pick from 'lodash/pick'\r\nimport isObject from 'lodash/isObject'\r\nimport isNil from 'lodash/isNil'\r\nimport isFunction from 'lodash/isFunction'\r\n\r\nimport assignAlias from './alias'\r\nimport {\r\n  RESOURCE_IDENTIFIER_ESSENTIAL_PROPS\r\n} from '../../resource/props'\r\n\r\nfunction transform(data, options) {\r\n  if (isObject(options)) {\r\n    if ('alias' in options) {\r\n      data = assignAlias(data, options.alias)\r\n    }\r\n\r\n    if ('defaults' in options) {\r\n      data = defaults({}, data, options.defaults)\r\n    }\r\n\r\n    if ('merge' in options) {\r\n      data = merge({}, data, options.merge)\r\n    }\r\n  }\r\n\r\n  if (isObject(data)) {\r\n    data = Object.assign({}, data)\r\n\r\n    for (let prop of RESOURCE_IDENTIFIER_ESSENTIAL_PROPS) {\r\n      if (isNil(data[prop])) {\r\n        if('fallback' in options) {\r\n          if(isFunction(options.fallback)) {\r\n            data = options.fallback(data)\r\n          } else {\r\n            data = options.fallback\r\n          }\r\n\r\n          break\r\n        }\r\n\r\n        const error = new TypeError(`Cannot transform '${ prop }' prop to string`)\r\n        Object.assign(error, {\r\n          data,\r\n          prop\r\n        })\r\n\r\n        throw error\r\n      }\r\n\r\n      data[prop] += ''\r\n    }\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nexport default transform\r\n","import isNil from 'lodash/isNil'\r\nimport isEmpty from 'lodash/isEmpty'\r\nimport pick from 'lodash/pick'\r\nimport isObject from 'lodash/isObject'\r\nimport isFunction from 'lodash/isFunction'\r\n\r\nimport {\r\n  RESOURCE_PROPS\r\n} from '../../resource/props'\r\n\r\nfunction transformObject(data, options) {\r\n  if (isNil(data)) {\r\n    return null\r\n  }\r\n\r\n  if (isObject(options)) {\r\n    if('fields' in options) {\r\n      const attributes = pick(data.attributes, options.fields)\r\n\r\n      if(!isEmpty(attributes)) {\r\n        data.attributes = attributes\r\n      }\r\n    }\r\n  }\r\n\r\n  data = pick(data, RESOURCE_PROPS)\r\n\r\n  return data\r\n}\r\n\r\nexport default transformObject\r\n","import pick from 'lodash/pick'\r\nimport omit from 'lodash/omit'\r\nimport defaults from 'lodash/defaults'\r\nimport isEmpty from 'lodash/isEmpty'\r\nimport isObject from 'lodash/isObject'\r\nimport isFunction from 'lodash/isFunction'\r\n\r\nimport {\r\n  RESOURCE_PROPS\r\n} from '../../resource/props'\r\n\r\nfunction coreTransformObject(data, options) {\r\n  const alienMembers = omit(data, RESOURCE_PROPS)\r\n\r\n  if(!isEmpty(alienMembers)) {\r\n    data.attributes = defaults(data.attributes, alienMembers)\r\n  }\r\n\r\n  if (isObject(options)) {\r\n    if ('links' in options) {\r\n      if(isFunction(options.links)) {\r\n        data.links = options.links(data.type, data.id)\r\n      } else {\r\n        data.links = Object.assign({}, options.links)\r\n      }\r\n    }\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nexport default coreTransformObject\r\n","import Avl from 'avl'\r\nimport isString from 'lodash/isString'\r\n\r\nconst createParseError = () => new TypeError(`Argument \"path\" should be non-empty string or array of strings`)\r\n\r\nclass Node {\r\n  constructor(options = {}) {\r\n    this.children = new Avl(this.compare.bind(this), true)\r\n  }\r\n\r\n  parse(path) {\r\n    if (Array.isArray(path)) {\r\n      for (let index in path) {\r\n        if (!isString(path[index])) {\r\n          throw createParseError()\r\n        }\r\n      }\r\n\r\n      return path\r\n    } else if (isString(path)) {\r\n      return path.split('.')\r\n    } else {\r\n      throw createParseError()\r\n    }\r\n  }\r\n\r\n  compare(a, b) {\r\n    a = this.parse(a)\r\n    b = this.parse(b)\r\n\r\n    if (a.length > b.length) {\r\n      return 1\r\n    } else if (a.length < b.length) {\r\n      return -1\r\n    } else {\r\n      for (let index in a) {\r\n        if (a[index] > b[index]) {\r\n          return 1\r\n        } else if (a[index] < b[index]) {\r\n          return -1\r\n        }\r\n      }\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  set() {\r\n    let path = []\r\n    let value = arguments[0]\r\n    let node = this\r\n    if (1 in arguments) {\r\n      path = arguments[0]\r\n      value = arguments[1]\r\n      node = node.sub(path, true)\r\n    }\r\n    node.value = value\r\n    return node\r\n  }\r\n\r\n  sub(path, create = false) {\r\n    path = this.parse(path)\r\n    let node = this\r\n\r\n    for (let index = 0; index < path.length; index++) {\r\n      const key = path[index]\r\n      let child = node.children.find(key)\r\n\r\n      if (child) {\r\n        node = child.data\r\n      } else if (create) {\r\n        child = new this.constructor()\r\n\r\n        node.children.insert(key, child)\r\n\r\n        node = child\r\n      } else {\r\n        node = null\r\n        break\r\n      }\r\n    }\r\n\r\n    return node\r\n  }\r\n\r\n  get(path) {\r\n    const node = this.sub(path)\r\n\r\n    if (node) {\r\n      return node.value\r\n    }\r\n  }\r\n\r\n  append(path, value) {\r\n    const node = this.sub(path, true)\r\n\r\n    node.set(value)\r\n\r\n    return node\r\n  }\r\n}\r\n\r\nexport default Node\r\n","module.exports = require(\"avl\");","module.exports = require(\"babel-runtime/core-js/array/from\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/core-js/set\");","module.exports = require(\"lodash/defaults\");","module.exports = require(\"lodash/get\");","module.exports = require(\"lodash/isEmpty\");","module.exports = require(\"lodash/isFunction\");","module.exports = require(\"lodash/isNil\");","module.exports = require(\"lodash/isObject\");","module.exports = require(\"lodash/isString\");","module.exports = require(\"lodash/merge\");","module.exports = require(\"lodash/omit\");","module.exports = require(\"lodash/once\");","module.exports = require(\"lodash/pick\");","module.exports = require(\"lodash/set\");"],"sourceRoot":""}